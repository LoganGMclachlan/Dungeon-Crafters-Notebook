import{u as Ce,r as d,j as n,d as ae,e as C,f as w,h as k,i as Ne,R as B,k as $,H as se,l as ke,L as ie,m as U,n as M,E as le,o as ce,p as De,q as Le,t as Be,v as Oe}from"./index-4df8e324.js";function Ae({game:e,setGame:t,details:o}){const r=Ce(),[s,a]=d.useState(e.title),[i,l]=d.useState(e.colour),[p,m]=d.useState(!1);d.useEffect(()=>{x()},[]);const x=()=>{const f=localStorage.getItem("SAVED_GAMES");if(f===null)return;JSON.parse(f).map(c=>{c.game.id===e.id&&m(!0)})},u=()=>{let f=[];const y=localStorage.getItem("SAVED_GAMES");y!==null&&(f=JSON.parse(y)),f.push({game:e,blocks:o[0],folders:o[1],links:o[2],boards:o[3],placements:o[4]}),localStorage.setItem("SAVED_GAMES",JSON.stringify(f)),m(!0),alert(`Downloaded ${e.title}`)},g=()=>{if(!window.confirm("Remove this game from downloads?"))return;const f=localStorage.getItem("SAVED_GAMES");let y=JSON.parse(f);y=y.filter(c=>c.game.id!==e.id),localStorage.setItem("SAVED_GAMES",JSON.stringify(y)),m(!1)},b=async f=>{if(f.preventDefault(),s===""){alert("Please enter a title");return}t({...e,title:s,colour:i});try{await ae(C(w,"Games",e.id),{title:s,colour:i})}catch(y){console.error(y)}},j=async()=>{if(window.confirm("Are you sure you want to delete this game?"))try{o.map((f,y)=>{switch(console.log(f),y){case 0:f.map(async c=>{await k(C(w,"Blocks",c.id)),console.log("Deleted block: "+c.title)});break;case 1:f.map(async c=>{await k(C(w,"Folders",c.id)),console.log("Deleted folder: "+c.title)});break;case 2:f.map(async c=>{await k(C(w,"Links",c.id)),console.log("Deleted link: "+c.id)});break;case 3:f.map(async c=>{await k(C(w,"Boards",c.id)),console.log("Deleted board: "+c.title)});break;case 4:f.map(async c=>{await k(C(w,"Placements",c.id)),console.log("Deleted placement: "+c.id)});break}}),await k(C(w,"Games",e.id)),console.log("Delete game: "+e.title),r("/")}catch(f){alert("there was a problem deleting this game try again later."),console.error(f)}},N=()=>{localStorage.setItem("SELECTED_BLOCKS",JSON.stringify(null)),localStorage.setItem("SELECTED_BOARD",JSON.stringify(null)),r("/")};return n.jsx("div",{className:"menu",children:n.jsxs("div",{className:"container details",children:[n.jsx("h1",{children:"Game Details"}),n.jsxs("form",{onSubmit:f=>b(f),children:[n.jsx("input",{value:s,onChange:f=>a(f.target.value),className:"form-input",placeholder:"Enter a title..."}),n.jsx("br",{}),n.jsxs("select",{onChange:f=>l(f.target.value),className:"form-input",value:i,children:[n.jsx("option",{disabled:!0,children:"Select a Colour"}),n.jsx("option",{value:"red",children:"Red"}),n.jsx("option",{value:"yellow",children:"Yellow"}),n.jsx("option",{value:"greenyellow",children:"Green"}),n.jsx("option",{value:"lightskyblue",children:"Blue"}),n.jsx("option",{value:"grey",children:"Grey"}),n.jsx("option",{value:"rgb(155, 3, 155)",children:"Purple"})]}),n.jsx("br",{}),n.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:[n.jsx("button",{type:"submit",className:"form-btn",children:"Save Details"}),n.jsx("button",{className:"form-btn",onClick:()=>N(),children:"Exit Game"}),n.jsx("button",{className:"form-btn red",onClick:()=>j(),children:"Delete Game"}),p?n.jsx("button",{className:"form-btn",onClick:()=>g(),children:"Downloaded"}):n.jsx("button",{className:"form-btn",onClick:()=>u(),children:"Download Game"}),n.jsx("small",{children:"Download feature not yet fully functional."})]})]})]})})}function Te({blocks:e,select:t}){return n.jsx("ul",{className:"block-snippets",children:e.map(o=>n.jsx("li",{onClick:()=>t(o),children:n.jsx("p",{children:o.title})},o.id))})}var de={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function o(){for(var r=[],s=0;s<arguments.length;s++){var a=arguments[s];if(a){var i=typeof a;if(i==="string"||i==="number")r.push(a);else if(Array.isArray(a)){if(a.length){var l=o.apply(null,a);l&&r.push(l)}}else if(i==="object"){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){r.push(a.toString());continue}for(var p in a)t.call(a,p)&&a[p]&&r.push(p)}}}return r.join(" ")}e.exports?(o.default=o,e.exports=o):window.classNames=o})()})(de);var Re=de.exports;const I=Ne(Re);function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},Y.apply(this,arguments)}function ue(e,t){if(e==null)return{};var o={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(o[s]=e[s]);return o}function te(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function Ie(e){var t=_e(e,"string");return typeof t=="symbol"?t:String(t)}function _e(e,t){if(typeof e!="object"||e===null)return e;var o=e[Symbol.toPrimitive];if(o!==void 0){var r=o.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Me(e,t,o){var r=d.useRef(e!==void 0),s=d.useState(t),a=s[0],i=s[1],l=e!==void 0,p=r.current;return r.current=l,!l&&p&&a!==t&&i(t),[l?e:a,d.useCallback(function(m){for(var x=arguments.length,u=new Array(x>1?x-1:0),g=1;g<x;g++)u[g-1]=arguments[g];o&&o.apply(void 0,[m].concat(u)),i(m)},[o])]}function Ge(e,t){return Object.keys(t).reduce(function(o,r){var s,a=o,i=a[te(r)],l=a[r],p=ue(a,[te(r),r].map(Ie)),m=t[r],x=Me(l,i,e[m]),u=x[0],g=x[1];return Y({},p,(s={},s[r]=u,s[m]=g,s))},e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},q(e,t)}function Fe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,q(e,t)}const Pe=["xxl","xl","lg","md","sm","xs"],$e="xs",Ve=d.createContext({prefixes:{},breakpoints:Pe,minBreakpoint:$e});function G(e,t){const{prefixes:o}=d.useContext(Ve);return e||o[t]||t}function Ue(e){return e&&e.ownerDocument||document}function He(e){var t=Ue(e);return t&&t.defaultView||window}function Je(e,t){return He(e).getComputedStyle(e,t)}var Ke=/([A-Z])/g;function Xe(e){return e.replace(Ke,"-$1").toLowerCase()}var ze=/^ms-/;function H(e){return Xe(e).replace(ze,"-ms-")}var We=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function Ye(e){return!!(e&&We.test(e))}function K(e,t){var o="",r="";if(typeof t=="string")return e.style.getPropertyValue(H(t))||Je(e).getPropertyValue(H(t));Object.keys(t).forEach(function(s){var a=t[s];!a&&a!==0?e.style.removeProperty(H(s)):Ye(s)?r+=s+"("+a+") ":o+=H(s)+": "+a+";"}),r&&(o+="transform: "+r+";"),e.style.cssText+=";"+o}const ne={disabled:!1},fe=B.createContext(null);var qe=function(t){return t.scrollTop},V="unmounted",A="exited",T="entering",R="entered",X="exiting",O=function(e){Fe(t,e);function t(r,s){var a;a=e.call(this,r,s)||this;var i=s,l=i&&!i.isMounting?r.enter:r.appear,p;return a.appearStatus=null,r.in?l?(p=A,a.appearStatus=T):p=R:r.unmountOnExit||r.mountOnEnter?p=V:p=A,a.state={status:p},a.nextCallback=null,a}t.getDerivedStateFromProps=function(s,a){var i=s.in;return i&&a.status===V?{status:A}:null};var o=t.prototype;return o.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},o.componentDidUpdate=function(s){var a=null;if(s!==this.props){var i=this.state.status;this.props.in?i!==T&&i!==R&&(a=T):(i===T||i===R)&&(a=X)}this.updateStatus(!1,a)},o.componentWillUnmount=function(){this.cancelNextCallback()},o.getTimeouts=function(){var s=this.props.timeout,a,i,l;return a=i=l=s,s!=null&&typeof s!="number"&&(a=s.exit,i=s.enter,l=s.appear!==void 0?s.appear:i),{exit:a,enter:i,appear:l}},o.updateStatus=function(s,a){if(s===void 0&&(s=!1),a!==null)if(this.cancelNextCallback(),a===T){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:$.findDOMNode(this);i&&qe(i)}this.performEnter(s)}else this.performExit();else this.props.unmountOnExit&&this.state.status===A&&this.setState({status:V})},o.performEnter=function(s){var a=this,i=this.props.enter,l=this.context?this.context.isMounting:s,p=this.props.nodeRef?[l]:[$.findDOMNode(this),l],m=p[0],x=p[1],u=this.getTimeouts(),g=l?u.appear:u.enter;if(!s&&!i||ne.disabled){this.safeSetState({status:R},function(){a.props.onEntered(m)});return}this.props.onEnter(m,x),this.safeSetState({status:T},function(){a.props.onEntering(m,x),a.onTransitionEnd(g,function(){a.safeSetState({status:R},function(){a.props.onEntered(m,x)})})})},o.performExit=function(){var s=this,a=this.props.exit,i=this.getTimeouts(),l=this.props.nodeRef?void 0:$.findDOMNode(this);if(!a||ne.disabled){this.safeSetState({status:A},function(){s.props.onExited(l)});return}this.props.onExit(l),this.safeSetState({status:X},function(){s.props.onExiting(l),s.onTransitionEnd(i.exit,function(){s.safeSetState({status:A},function(){s.props.onExited(l)})})})},o.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},o.safeSetState=function(s,a){a=this.setNextCallback(a),this.setState(s,a)},o.setNextCallback=function(s){var a=this,i=!0;return this.nextCallback=function(l){i&&(i=!1,a.nextCallback=null,s(l))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},o.onTransitionEnd=function(s,a){this.setNextCallback(a);var i=this.props.nodeRef?this.props.nodeRef.current:$.findDOMNode(this),l=s==null&&!this.props.addEndListener;if(!i||l){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var p=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],m=p[0],x=p[1];this.props.addEndListener(m,x)}s!=null&&setTimeout(this.nextCallback,s)},o.render=function(){var s=this.state.status;if(s===V)return null;var a=this.props,i=a.children;a.in,a.mountOnEnter,a.unmountOnExit,a.appear,a.enter,a.exit,a.timeout,a.addEndListener,a.onEnter,a.onEntering,a.onEntered,a.onExit,a.onExiting,a.onExited,a.nodeRef;var l=ue(a,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return B.createElement(fe.Provider,{value:null},typeof i=="function"?i(s,l):B.cloneElement(B.Children.only(i),l))},t}(B.Component);O.contextType=fe;O.propTypes={};function _(){}O.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:_,onEntering:_,onEntered:_,onExit:_,onExiting:_,onExited:_};O.UNMOUNTED=V;O.EXITED=A;O.ENTERING=T;O.ENTERED=R;O.EXITING=X;const Ze=O,Qe=!!(typeof window<"u"&&window.document&&window.document.createElement);var Z=!1,Q=!1;try{var W={get passive(){return Z=!0},get once(){return Q=Z=!0}};Qe&&(window.addEventListener("test",W,W),window.removeEventListener("test",W,!0))}catch{}function et(e,t,o,r){if(r&&typeof r!="boolean"&&!Q){var s=r.once,a=r.capture,i=o;!Q&&s&&(i=o.__once||function l(p){this.removeEventListener(t,l,a),o.call(this,p)},o.__once=i),e.addEventListener(t,i,Z?r:a)}e.addEventListener(t,o,r)}function tt(e,t,o,r){var s=r&&typeof r!="boolean"?r.capture:r;e.removeEventListener(t,o,s),o.__once&&e.removeEventListener(t,o.__once,s)}function pe(e,t,o,r){return et(e,t,o,r),function(){tt(e,t,o,r)}}function nt(e,t,o,r){if(o===void 0&&(o=!1),r===void 0&&(r=!0),e){var s=document.createEvent("HTMLEvents");s.initEvent(t,o,r),e.dispatchEvent(s)}}function ot(e){var t=K(e,"transitionDuration")||"",o=t.indexOf("ms")===-1?1e3:1;return parseFloat(t)*o}function rt(e,t,o){o===void 0&&(o=5);var r=!1,s=setTimeout(function(){r||nt(e,"transitionend",!0)},t+o),a=pe(e,"transitionend",function(){r=!0},{once:!0});return function(){clearTimeout(s),a()}}function at(e,t,o,r){o==null&&(o=ot(e)||0);var s=rt(e,o,r),a=pe(e,"transitionend",t);return function(){s(),a()}}function oe(e,t){const o=K(e,t)||"",r=o.indexOf("ms")===-1?1e3:1;return parseFloat(o)*r}function st(e,t){const o=oe(e,"transitionDuration"),r=oe(e,"transitionDelay"),s=at(e,a=>{a.target===e&&(s(),t(a))},o+r)}function P(...e){return e.filter(t=>t!=null).reduce((t,o)=>{if(typeof o!="function")throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return t===null?o:function(...s){t.apply(this,s),o.apply(this,s)}},null)}function it(e){e.offsetHeight}const re=e=>!e||typeof e=="function"?e:t=>{e.current=t};function lt(e,t){const o=re(e),r=re(t);return s=>{o&&o(s),r&&r(s)}}function ct(e,t){return d.useMemo(()=>lt(e,t),[e,t])}function dt(e){return e&&"setState"in e?$.findDOMNode(e):e??null}const ut=B.forwardRef(({onEnter:e,onEntering:t,onEntered:o,onExit:r,onExiting:s,onExited:a,addEndListener:i,children:l,childRef:p,...m},x)=>{const u=d.useRef(null),g=ct(u,p),b=v=>{g(dt(v))},j=v=>S=>{v&&u.current&&v(u.current,S)},N=d.useCallback(j(e),[e]),f=d.useCallback(j(t),[t]),y=d.useCallback(j(o),[o]),c=d.useCallback(j(r),[r]),h=d.useCallback(j(s),[s]),E=d.useCallback(j(a),[a]),L=d.useCallback(j(i),[i]);return n.jsx(Ze,{ref:x,...m,onEnter:N,onEntered:y,onEntering:f,onExit:c,onExited:E,onExiting:h,addEndListener:L,nodeRef:u,children:typeof l=="function"?(v,S)=>l(v,{...S,ref:b}):B.cloneElement(l,{ref:b})})}),ft=ut,pt={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function ht(e,t){const o=`offset${e[0].toUpperCase()}${e.slice(1)}`,r=t[o],s=pt[e];return r+parseInt(K(t,s[0]),10)+parseInt(K(t,s[1]),10)}const mt={[A]:"collapse",[X]:"collapsing",[T]:"collapsing",[R]:"collapse show"},xt=B.forwardRef(({onEnter:e,onEntering:t,onEntered:o,onExit:r,onExiting:s,className:a,children:i,dimension:l="height",in:p=!1,timeout:m=300,mountOnEnter:x=!1,unmountOnExit:u=!1,appear:g=!1,getDimensionValue:b=ht,...j},N)=>{const f=typeof l=="function"?l():l,y=d.useMemo(()=>P(v=>{v.style[f]="0"},e),[f,e]),c=d.useMemo(()=>P(v=>{const S=`scroll${f[0].toUpperCase()}${f.slice(1)}`;v.style[f]=`${v[S]}px`},t),[f,t]),h=d.useMemo(()=>P(v=>{v.style[f]=null},o),[f,o]),E=d.useMemo(()=>P(v=>{v.style[f]=`${b(f,v)}px`,it(v)},r),[r,b,f]),L=d.useMemo(()=>P(v=>{v.style[f]=null},s),[f,s]);return n.jsx(ft,{ref:N,addEndListener:st,...j,"aria-expanded":j.role?p:null,onEnter:y,onEntering:c,onEntered:h,onExit:E,onExiting:L,childRef:i.ref,in:p,timeout:m,mountOnEnter:x,unmountOnExit:u,appear:g,children:(v,S)=>B.cloneElement(i,{...S,className:I(a,i.props.className,mt[v],f==="width"&&"collapse-horizontal")})})}),vt=xt;function he(e,t){return Array.isArray(e)?e.includes(t):e===t}const me=d.createContext({});me.displayName="AccordionContext";const z=me,xe=d.forwardRef(({as:e="div",bsPrefix:t,className:o,children:r,eventKey:s,...a},i)=>{const{activeEventKey:l}=d.useContext(z);return t=G(t,"accordion-collapse"),n.jsx(vt,{ref:i,in:he(l,s),...a,className:I(o,t),children:n.jsx(e,{children:d.Children.only(r)})})});xe.displayName="AccordionCollapse";const ve=xe,ge=d.createContext({eventKey:""});ge.displayName="AccordionItemContext";const ee=ge,ye=d.forwardRef(({as:e="div",bsPrefix:t,className:o,onEnter:r,onEntering:s,onEntered:a,onExit:i,onExiting:l,onExited:p,...m},x)=>{t=G(t,"accordion-body");const{eventKey:u}=d.useContext(ee);return n.jsx(ve,{eventKey:u,onEnter:r,onEntering:s,onEntered:a,onExit:i,onExiting:l,onExited:p,children:n.jsx(e,{ref:x,...m,className:I(o,t)})})});ye.displayName="AccordionBody";const gt=ye;function yt(e,t){const{activeEventKey:o,onSelect:r,alwaysOpen:s}=d.useContext(z);return a=>{let i=e===o?null:e;s&&(Array.isArray(o)?o.includes(e)?i=o.filter(l=>l!==e):i=[...o,e]:i=[e]),r==null||r(i,a),t==null||t(a)}}const je=d.forwardRef(({as:e="button",bsPrefix:t,className:o,onClick:r,...s},a)=>{t=G(t,"accordion-button");const{eventKey:i}=d.useContext(ee),l=yt(i,r),{activeEventKey:p}=d.useContext(z);return e==="button"&&(s.type="button"),n.jsx(e,{ref:a,onClick:l,...s,"aria-expanded":Array.isArray(p)?p.includes(i):i===p,className:I(o,t,!he(p,i)&&"collapsed")})});je.displayName="AccordionButton";const we=je,Ee=d.forwardRef(({as:e="h2",bsPrefix:t,className:o,children:r,onClick:s,...a},i)=>(t=G(t,"accordion-header"),n.jsx(e,{ref:i,...a,className:I(o,t),children:n.jsx(we,{onClick:s,children:r})})));Ee.displayName="AccordionHeader";const jt=Ee,be=d.forwardRef(({as:e="div",bsPrefix:t,className:o,eventKey:r,...s},a)=>{t=G(t,"accordion-item");const i=d.useMemo(()=>({eventKey:r}),[r]);return n.jsx(ee.Provider,{value:i,children:n.jsx(e,{ref:a,...s,className:I(o,t)})})});be.displayName="AccordionItem";const wt=be,Se=d.forwardRef((e,t)=>{const{as:o="div",activeKey:r,bsPrefix:s,className:a,onSelect:i,flush:l,alwaysOpen:p,...m}=Ge(e,{activeKey:"onSelect"}),x=G(s,"accordion"),u=d.useMemo(()=>({activeEventKey:r,onSelect:i,alwaysOpen:p}),[r,i,p]);return n.jsx(z.Provider,{value:u,children:n.jsx(o,{ref:t,...m,className:I(a,x,l&&`${x}-flush`)})})});Se.displayName="Accordion";const J=Object.assign(Se,{Button:we,Collapse:ve,Item:wt,Header:jt,Body:gt});function Et({folders:e,blocks:t,select:o,newBlock:r,setFolders:s,gameId:a}){async function i(l){if(!navigator.onLine){alert("Cannot delete folders while offline");return}if(!window.confirm("Are you sure want to delete this folder & its blocks?"))return;const p=t.filter(m=>m.folderid===l.id);try{p.map(async m=>{await k(C(w,"Blocks",m.id))}),await k(C(w,"Folders",l.id)),s(e.filter(m=>m.id!==l.id))}catch(m){console.error(m),alert("Failed to delete this folder, try again later.")}}return n.jsx(J,{className:"accordion-container",children:e.map(l=>n.jsxs(J.Item,{eventKey:l.id,style:{border:"1px solid grey"},children:[n.jsx(J.Header,{children:l.title}),n.jsxs(J.Body,{style:{paddingTop:"20px",paddingLeft:"8px",paddingRight:"8px"},children:[n.jsx(Te,{blocks:t.filter(p=>p.folderid===l.id),select:o}),n.jsxs("span",{className:"folder-btn",children:[n.jsx("button",{onClick:()=>r(l.id),children:"New Block"}),n.jsx("button",{style:{backgroundColor:"red"},onClick:()=>i(l),children:"Delete Folder"})]})]})]},l.id))})}const bt=`
<h1>Main Heading</h1>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
<hr/>
<h1>Main Heading</h1>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
`,St=`
<h2>Numbered List</h2>
<ol>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
</ol>
<p></p>
`,Ct=`
<h2>Dotted List</h2>
<ul>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
</ul>
<p></p>
`,Nt=`
<table>
    <tr>
        <th>heading</th>
        <th>heading</th>
        <th>heading</th>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
</table>
<p></p>
`;function kt({content:e,close:t}){return n.jsxs("li",{children:[n.jsx("label",{children:"Use Template: "}),n.jsxs("select",{className:"option-select",defaultValue:"defualt",onChange:o=>{e[1](e[0]+o.target.value),t()},children:[n.jsx("option",{value:"defualt",disabled:!0,children:"None"}),n.jsx("option",{value:bt,children:"Headings"}),n.jsx("option",{value:St,children:"Numbered List"}),n.jsx("option",{value:Ct,children:"Dotted List"}),n.jsx("option",{value:Nt,children:"Table"})]})]})}function Dt({colour:e,gameId:t,data:o,blocks:r,links:s,closeBlock:a,blockLinks:i,block:l,placements:p,boards:m,content:x}){const[u,g]=d.useState(!1),b=async c=>{if(c.preventDefault(),g(!1),!navigator.onLine){alert("Cannot save blocks while offline");return}try{let h=l;h.title=o[0],h.content=o[1],l.new?(delete h.new,await U(M(w,"Blocks"),h).then(E=>{h.id=E.id,r[1]([...r[0],h])})):(await ae(C(w,"Blocks",l.id),{title:o[0],content:o[1]}),r[1](r[0].map(E=>E.id===h.id?h:E))),alert("Block saved successfuly!")}catch(h){console.error(h),alert("Failed to save this block, try again later.")}},j=async()=>{if(!navigator.onLine){alert("Cannot delete blocks while offline");return}if(window.confirm("Are you sure you want to delete this block?"))try{await k(C(w,"Blocks",l.id)),r[1](r[0].filter(h=>h.id!=l.id));let c=[...s[0]];i.map(async h=>{await k(C(w,"Links",h.linkId)).then(c=c.filter(E=>E.id!==h.linkId))}),s[1](c),p.map(async h=>{h.blockid===l.id&&await k(C(w,"Placements",h.id))}),p[1]([...p[0].filter(h=>h.blockid!==l.id)]),a()}catch(c){console.error(c),alert("Something went wrong, try again later.")}},N=async c=>{if(!navigator.onLine){alert("Cannot link blocks while offline");return}if(c===l.id){alert("Cannot link a block to itself");return}let h=!1;if(i.map(E=>{E.id===c&&(h=!0)}),h){alert("Selected block is already linked to this one");return}try{let E={block1:l.id,block2:c,gameid:t};await U(M(w,"Links"),E).then(L=>{E.id=L.id,s[1]([...s[0],E])})}catch(E){console.error(E),alert("Something went wrong, try again later.")}},f=async c=>{if(!navigator.onLine){alert("Cannot add to boards while offline");return}try{let h={blockid:l.id,boardid:c,gameid:t};await U(M(w,"Placements"),h).then(E=>{h.id=E.id}),p[1]([...p[0],h]),alert("Block added to selected board.")}catch(h){console.error(h),alert("Something went wrong, try again later.")}},y=()=>g(!1);return n.jsxs("div",{style:{display:"inline"},children:[n.jsx("button",{className:"options-btn",onClick:()=>g(!u),style:{backgroundColor:`${e}`},children:"Options"}),n.jsx(se,{message:ke}),u&&n.jsxs("ul",{className:"options-collapse",children:[n.jsx("li",{onClick:y,children:"Close Options"}),n.jsx("li",{onClick:c=>b(c),children:"Save"}),n.jsx(kt,{content:x,close:y}),!l.new&&n.jsxs(n.Fragment,{children:[n.jsxs("li",{children:[n.jsx("label",{children:"Link to: "}),n.jsxs("select",{className:"option-select",defaultValue:"defualt",onChange:c=>{N(c.target.value),y()},children:[n.jsx("option",{value:"defualt",disabled:!0,children:"Select Block"}),r[0].map(c=>n.jsx("option",{value:c.id,children:c.title},c.id))]})]}),n.jsxs("li",{children:[n.jsx("label",{children:"Add to Board: "}),n.jsxs("select",{className:"option-select",defaultValue:"defualt",onChange:c=>{f(c.target.value),y()},children:[n.jsx("option",{value:"defualt",disabled:!0,children:"Select Board"}),m.map(c=>n.jsx("option",{value:c.id,children:c.title},c.id))]})]}),n.jsx("li",{children:n.jsx(ie,{to:"../share/"+l.id,target:"_blank",children:"Share"})}),n.jsx("li",{onClick:j,style:{color:"red"},children:"Delete"})]})]})]})}function Lt({content:e,setContent:t}){return n.jsx(le,{apiKey:"c70a4j85ev1e4q1dopyxbpw772r0lz047pef9umlig63xfdh",value:e,onEditorChange:(o,r)=>t(r.getContent()),init:{height:360,menubar:!1,browser_spellcheck:!0,resize:!1,plugins:"table | lists",toolbar:"undo redo | blocks | bold italic forecolor | bullist numlist outdent indent | table tabledelete | tableprops tablerowprops tablecellprops | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol"}})}function Bt({block:e,setBlocks:t,close:o,blocks:r,colour:s,gameId:a,links:i,setLinks:l,select:p,setPlacements:m,boards:x,placements:u}){const[g,b]=d.useState(""),[j,N]=d.useState(""),[f,y]=d.useState([]);d.useEffect(()=>{b(e.title),N(e.content),y(c())},[e]),d.useEffect(()=>{y(c())},[i]);const c=()=>{let v=[];return i.map(S=>{if(S.block1===e.id){let D=r.filter(F=>F.id===S.block2)[0];D.linkId=S.id,v.push(D)}else if(S.block2===e.id){let D=r.filter(F=>F.id===S.block1)[0];D.linkId=S.id,v.push(D)}}),v},h=()=>{j!==e.content&&!window.confirm("Unsaved changes detected, are you sure you want to continue?")||o()},E=async(v,S)=>{if(!navigator.onLine){alert("Cannot delete links while offline");return}if(window.confirm(`Are you sure you want to delete the link to "${S}"?`))try{await k(C(w,"Links",v));let D=[...i].filter(F=>F.id!==v);l(D),L(D)}catch(D){console.error(D),alert("Something went wrong, try again later.")}},L=v=>{let S=JSON.parse(localStorage.getItem("SAVED_GAMES"));S!==null&&(S.map(D=>(D.game.id===a&&(D.links=v),D)),localStorage.setItem("SAVED_GAMES",JSON.stringify(S)))};return n.jsxs("div",{className:"block",children:[n.jsx(Dt,{colour:s,gameId:a,data:[g,j],content:[j,N],blocks:[r,t],boards:x,links:[i,l],closeBlock:o,blockLinks:f,block:e,placements:[u,m]}),n.jsx("button",{className:"x-btn",onClick:h,children:"X"}),n.jsx("input",{value:g,className:"block-title",onChange:v=>b(v.target.value)}),n.jsx("br",{}),navigator.onLine?n.jsx(Lt,{content:j,setContent:N}):n.jsx("textarea",{value:ce(j,{wordwrap:80}),className:"block-content"}),n.jsxs("p",{className:"related-blocks",children:[n.jsx("b",{children:"Related: "}),f.map(v=>n.jsxs("span",{children:[n.jsx("span",{onClick:()=>p(v),children:v.title}),n.jsx("label",{onClick:()=>E(v.linkId,v.title),children:"X"})]},v.id))]})]})}function Ot({setFolders:e,folders:t,gameId:o}){const[r,s]=d.useState("");async function a(i){if(i.preventDefault(),!navigator.onLine){alert("Cannot create folders while offline");return}if(r===""){alert("Enter a title for your new folder first.");return}if(r.length>25){alert("Folder titles cannot be longer than 25 digits long.");return}try{await U(M(w,"Folders"),{title:r,gameid:o}).then(l=>{e([...t,{id:l.id,title:r,gameid:o}])}),s("")}catch(l){console.error(l),alert("Something went wrong and we coudlnt create your folder, please try again later")}}return n.jsxs("form",{onSubmit:i=>a(i),children:[n.jsx("input",{placeholder:"Folder title...",className:"form-input",style:{width:"85%",marginBottom:"-5px"},value:r,onChange:i=>s(i.target.value),style:{width:"70%",marginBottom:"0px"}}),n.jsx(se,{message:De}),n.jsx("button",{className:"form-btn",style:{width:"85%",padding:"5px"},type:"submit",children:"New Folder"})]})}function At({select:e,blocks:t}){const[o,r]=d.useState([]);function s(a){if(a===""){r([]);return}r(t.filter(i=>i.title.toLowerCase().includes(a.toLowerCase())))}return n.jsxs(n.Fragment,{children:[n.jsx("input",{placeholder:"Search...",className:"search-bar",onChange:a=>s(a.target.value),onClick:a=>s(a.target.value)}),n.jsx("ul",{className:"search-results",children:o.map(a=>n.jsx("li",{onClick:()=>{e(a),s("")},children:a.title}))})]})}function Tt({blocks:e,gameId:t,setBlocks:o,folders:r,setFolders:s,colour:a,links:i,setLinks:l,setPlacements:p,boards:m,placements:x}){const[u,g]=d.useState(()=>{const f=localStorage.getItem("SELECTED_BLOCKS");return JSON.parse(f)===null?[]:JSON.parse(f)});d.useEffect(()=>{localStorage.setItem("SELECTED_BLOCKS",JSON.stringify(u))},[u]);const b=f=>{j({title:"New Block",content:"",gameid:t,folderid:f,new:!0})},j=f=>{u.includes(f)||g([...u,f])},N=f=>g([...u].filter(y=>y.id!==f));return n.jsxs("div",{style:{display:"flex"},className:"blocks-container",children:[n.jsxs("div",{className:"folderList",children:[n.jsx(At,{select:j,blocks:e}),r.length>0&&n.jsx(Et,{folders:r,blocks:e,select:j,newBlock:b,setFolders:s,gameId:t}),n.jsx(Ot,{setFolders:s,folders:r,gameId:t})]}),n.jsx("div",{className:"block-list",children:u.map(f=>n.jsx(Bt,{block:f,blocks:e,colour:a,gameId:t,setLinks:l,setBlocks:o,close:()=>N(f.id),links:i,select:j,setPlacements:p,boards:m,placements:x},f.id))})]})}const Rt="/assets/YlWC-82c90721.gif";function It(){const[e,t]=d.useState(null),[o,r]=d.useState(20),s=()=>{t(Math.floor(Math.random()*o)+1);var a=document.getElementById("result");a.style.fontSize="1.4em",setTimeout(()=>a.style.fontSize="1.3em",200)};return n.jsxs("span",{style:{marginTop:"10px",marginLeft:"auto"},children:[n.jsxs("select",{style:{padding:"3px"},onChange:a=>{r(a.target.value),s()},children:[n.jsx("option",{value:20,default:!0,children:"d20"}),n.jsx("option",{value:12,children:"d12"}),n.jsx("option",{value:10,children:"d10"}),n.jsx("option",{value:8,children:"d8"}),n.jsx("option",{value:6,children:"d6"}),n.jsx("option",{value:4,children:"d4"}),n.jsx("option",{value:100,children:"d100"})]}),n.jsx("button",{onClick:s,style:{border:"none",padding:"2px"},children:"Roll!"}),n.jsx("div",{className:"roll-result",children:e&&n.jsx("div",{id:"result",children:e})})]})}function _t({selected:e,setSelected:t,game:o}){return n.jsxs("div",{className:"nav-bar",style:{backgroundColor:`${o.colour}`},children:[n.jsx("h1",{className:"nav-title",children:o.title}),o.title==="Loading"&&n.jsx("img",{src:Rt,className:"loading-icon"}),e==="blocks"?n.jsx("button",{className:"nav-item",style:{textDecoration:"underline"},children:"Blocks"}):n.jsx("button",{className:"nav-item",onClick:()=>t("blocks"),children:"Blocks"}),e==="boards"?n.jsx("button",{className:"nav-item",style:{textDecoration:"underline"},children:"Boards"}):n.jsx("button",{className:"nav-item",onClick:()=>t("boards"),children:"Boards"}),e==="details"?n.jsx("button",{className:"nav-item",style:{textDecoration:"underline"},children:"Details"}):n.jsx("button",{className:"nav-item",onClick:()=>t("details"),children:"Details"}),n.jsx(It,{})]})}function Mt({blocks:e,setPlacements:t,placements:o}){const[r,s]=d.useState([]);d.useEffect(()=>{s(e.sort((i,l)=>l.content.length-i.content.length))},[e]);const a=async i=>{if(window.confirm(`Are you sure you want to delete "${i.title}" from this board?`))try{await k(C(w,"Placements",i.placement)),t([...o].filter(l=>l.id!==i.placement))}catch(l){console.log(l),alert("something went wrong, try again later")}};return n.jsx("div",{className:"board-blocks",children:r.map(i=>n.jsxs("div",{children:[n.jsx("button",{className:"x-btn",onClick:()=>a(i),children:"X"}),n.jsx("h2",{children:i.title}),n.jsx("span",{children:navigator.onLine?n.jsx(le,{apiKey:"c70a4j85ev1e4q1dopyxbpw772r0lz047pef9umlig63xfdh",value:i.content,disabled:!0,inline:!0,init:{menubar:!1,toolbar:!1,resize:!1}}):n.jsx("textarea",{value:ce(i.content,{wordwrap:80})})})]},i.id))})}function Gt({boards:e,select:t,gameId:o,setBoards:r,placements:s,setPlacements:a,selected:i}){const[l,p]=d.useState(""),m=async()=>{if(!navigator.onLine){alert("Cannot create board while offline");return}try{let u={title:l,gameid:o};await U(M(w,"Boards"),u).then(g=>u.id=g.id),r([...e,u]),t(u.id),p(""),alert("New Board Created!")}catch(u){console.log(u),alert("Something went wrong, try again later.")}},x=async()=>{if(!i){alert("Select a board to delete.");return}if(!navigator.onLine){alert("Cannot delete boards while offline");return}if(window.confirm("Are you sure you want to delete this board?"))try{s.map(async u=>{u.boardid===i&&await k(C(w,"Placements",u.id))}),a([...s].filter(u=>u.boardid!==i)),await k(C(w,"Boards",i)),t(null)}catch(u){console.log(u),alert("Something went wrong, try again later.")}};return n.jsxs("div",{className:"board-control",children:[n.jsxs("div",{children:[n.jsxs("select",{defaultValue:"default",className:"form-input",style:{padding:"6px"},onChange:u=>t(u.target.value),children:[n.jsx("option",{value:"default",disabled:!0,children:"Select a Board"}),e.map(u=>n.jsx("option",{value:u.id,children:u.title},u.id))]}),n.jsx("br",{}),n.jsx("button",{className:"form-btn",style:{backgroundColor:"red"},onClick:()=>x(),children:"Delete Board"})]}),n.jsxs("div",{children:[n.jsx("input",{placeholder:"Board Title...",className:"form-input",value:l,onChange:u=>p(u.target.value)}),n.jsx("br",{}),n.jsx("button",{className:"form-btn",onClick:()=>m(),children:"Create Board"})]})]})}function Ft({boards:e,placements:t,blocks:o,gameId:r,setBoards:s,setPlacements:a}){const[i,l]=d.useState(()=>{const x=localStorage.getItem("SELECTED_BOARD");return JSON.parse(x)}),[p,m]=d.useState([]);return d.useEffect(()=>{localStorage.setItem("SELECTED_BOARD",JSON.stringify(i))},[i]),d.useEffect(()=>{let x=[];t.filter(u=>u.boardid===i).map(u=>{let g=o.find(b=>b.id===u.blockid);g.placement=u.id,x.push(g)}),m(x)},[i,t]),n.jsxs("div",{className:"boards-container",children:[n.jsx(Mt,{blocks:p,setPlacements:a,placements:t,gameId:r}),n.jsx(Gt,{boards:e,select:l,gameId:r,setBoards:s,placements:t,setPlacements:a,selected:i}),n.jsx("p",{className:"board-control",children:"Boards allow you to create custom collections of information from your blocks. Use this tool to gather all the info you would need for a session. Select a board to view the blocks within. You can click on a block to expand or minimise it. Click the X button to remove it from that board."})]})}function $t({user:e}){const t=Le(),[o,r]=d.useState("blocks"),[s,a]=d.useState({title:"Loading",colour:"red"}),[i,l]=d.useState([]),[p,m]=d.useState([]),[x,u]=d.useState([]),[g,b]=d.useState([]),[j,N]=d.useState([]);d.useEffect(()=>{if(navigator.onLine)f(),y("Blocks").then(c=>l(c)),y("Folders").then(c=>N(c)),y("Links").then(c=>m(c)),y("Boards").then(c=>u(c)),y("Placements").then(c=>b(c));else{const c=localStorage.getItem("SAVED_GAMES");c!==null&&JSON.parse(c).map(h=>{h.game.id===(t==null?void 0:t.state.gameid)&&(a(h.game),l(h.blocks),N(h.folders),m(h.links),u(h.boards),b(h.placements))})}},[]);const f=d.useCallback(async()=>{try{const c=await Be(C(w,"Games",t==null?void 0:t.state.gameid)),h={...c.data(),id:c.id};a(h)}catch(c){console.error(c)}}),y=d.useCallback(async c=>{try{return(await Oe(M(w,c))).docs.map(L=>({...L.data(),id:L.id})).filter(L=>L.gameid===(t==null?void 0:t.state.gameid))}catch(h){console.error(h)}});return n.jsx(n.Fragment,{children:e?n.jsxs(n.Fragment,{children:[n.jsx(_t,{selected:o,setSelected:r,game:s}),n.jsx("div",{children:s.title!=="Loading..."&&n.jsxs(n.Fragment,{children:[o==="details"&&n.jsx(Ae,{game:s,setGame:a,details:[i,j,p,x,g]}),o==="blocks"&&n.jsx(Tt,{blocks:i,setBlocks:l,colour:s.colour,setLinks:m,boards:x,gameId:s.id,folders:j,setFolders:N,links:p,setPlacements:b,placements:g}),o==="boards"&&n.jsx(Ft,{boards:x,setBoards:u,placements:g,blocks:i,gameId:s.id,setPlacements:b})]})})]}):n.jsxs("h1",{className:"menu",children:["You must first ",n.jsx(ie,{to:"/login",children:"login"})," to access this page"]})})}export{$t as default};
