import{u as Ce,r as d,j as n,d as ae,e as C,f as w,h as k,i as Ne,R as B,k as $,H as ie,l as ke,L as se,m as V,n as M,E as le,o as ce,p as De,q as Le,t as Be,v as Oe}from"./index-0e33ae1f.js";function Ae({game:e,setGame:t,details:r}){const o=Ce(),[i,a]=d.useState(e.title),[s,l]=d.useState(e.colour),[h,m]=d.useState(!1);d.useEffect(()=>{g()},[]);const g=()=>{const f=localStorage.getItem("SAVED_GAMES");if(f===null)return;JSON.parse(f).map(c=>{c.game.id===e.id&&m(!0)})},u=()=>{let f=[];const E=localStorage.getItem("SAVED_GAMES");E!==null&&(f=JSON.parse(E)),f.push({game:e,blocks:r[0],folders:r[1],links:r[2],boards:r[3],placements:r[4]}),localStorage.setItem("SAVED_GAMES",JSON.stringify(f)),m(!0),alert(`Downloaded ${e.title}`)},v=()=>{if(!window.confirm("Remove this game from downloads?"))return;const f=localStorage.getItem("SAVED_GAMES");let E=JSON.parse(f);E=E.filter(c=>c.game.id!==e.id),localStorage.setItem("SAVED_GAMES",JSON.stringify(E)),m(!1)},S=async f=>{if(f.preventDefault(),i===""){alert("Please enter a title");return}t({...e,title:i,colour:s});try{await ae(C(w,"Games",e.id),{title:i,colour:s})}catch(E){console.error(E)}},y=async()=>{if(window.confirm("Are you sure you want to delete this game?"))try{r.map((f,E)=>{switch(console.log(f),E){case 0:f.map(async c=>{await k(C(w,"Blocks",c.id)),console.log("Deleted block: "+c.title)});break;case 1:f.map(async c=>{await k(C(w,"Folders",c.id)),console.log("Deleted folder: "+c.title)});break;case 2:f.map(async c=>{await k(C(w,"Links",c.id)),console.log("Deleted link: "+c.id)});break;case 3:f.map(async c=>{await k(C(w,"Boards",c.id)),console.log("Deleted board: "+c.title)});break;case 4:f.map(async c=>{await k(C(w,"Placements",c.id)),console.log("Deleted placement: "+c.id)});break}}),await k(C(w,"Games",e.id)),console.log("Delete game: "+e.title),o("/")}catch(f){alert("there was a problem deleting this game try again later."),console.error(f)}},N=()=>{localStorage.setItem("SELECTED_BLOCKS",JSON.stringify(null)),localStorage.setItem("SELECTED_BOARD",JSON.stringify(null)),o("/")};return n.jsx("div",{className:"menu",children:n.jsxs("div",{className:"container details",children:[n.jsx("h1",{children:"Game Details"}),n.jsxs("form",{onSubmit:f=>S(f),children:[n.jsx("input",{value:i,onChange:f=>a(f.target.value),className:"form-input",placeholder:"Enter a title..."}),n.jsx("br",{}),n.jsxs("select",{onChange:f=>l(f.target.value),className:"form-input",value:s,children:[n.jsx("option",{disabled:!0,children:"Select a Colour"}),n.jsx("option",{value:"red",children:"Red"}),n.jsx("option",{value:"yellow",children:"Yellow"}),n.jsx("option",{value:"greenyellow",children:"Green"}),n.jsx("option",{value:"lightskyblue",children:"Blue"}),n.jsx("option",{value:"grey",children:"Grey"}),n.jsx("option",{value:"rgb(155, 3, 155)",children:"Purple"})]}),n.jsx("br",{}),n.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:[n.jsx("button",{type:"submit",className:"form-btn",children:"Save Details"}),n.jsx("button",{className:"form-btn",onClick:()=>N(),children:"Exit Game"}),n.jsx("button",{className:"form-btn red",onClick:()=>y(),children:"Delete Game"}),h?n.jsx("button",{className:"form-btn",onClick:()=>v(),children:"Downloaded"}):n.jsx("button",{className:"form-btn",onClick:()=>u(),children:"Download Game"}),n.jsx("small",{children:"Download feature not yet fully functional."})]})]})]})})}function Te({blocks:e,select:t}){return n.jsx("ul",{className:"block-snippets",children:e.map(r=>n.jsx("li",{onClick:()=>t(r),children:n.jsx("p",{children:r.title})},r.id))})}var de={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function r(){for(var o=[],i=0;i<arguments.length;i++){var a=arguments[i];if(a){var s=typeof a;if(s==="string"||s==="number")o.push(a);else if(Array.isArray(a)){if(a.length){var l=r.apply(null,a);l&&o.push(l)}}else if(s==="object"){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){o.push(a.toString());continue}for(var h in a)t.call(a,h)&&a[h]&&o.push(h)}}}return o.join(" ")}e.exports?(r.default=r,e.exports=r):window.classNames=r})()})(de);var Ie=de.exports;const R=Ne(Ie);function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},Y.apply(this,arguments)}function ue(e,t){if(e==null)return{};var r={},o=Object.keys(e),i,a;for(a=0;a<o.length;a++)i=o[a],!(t.indexOf(i)>=0)&&(r[i]=e[i]);return r}function te(e){return"default"+e.charAt(0).toUpperCase()+e.substr(1)}function Re(e){var t=_e(e,"string");return typeof t=="symbol"?t:String(t)}function _e(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var o=r.call(e,t||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Me(e,t,r){var o=d.useRef(e!==void 0),i=d.useState(t),a=i[0],s=i[1],l=e!==void 0,h=o.current;return o.current=l,!l&&h&&a!==t&&s(t),[l?e:a,d.useCallback(function(m){for(var g=arguments.length,u=new Array(g>1?g-1:0),v=1;v<g;v++)u[v-1]=arguments[v];r&&r.apply(void 0,[m].concat(u)),s(m)},[r])]}function Fe(e,t){return Object.keys(t).reduce(function(r,o){var i,a=r,s=a[te(o)],l=a[o],h=ue(a,[te(o),o].map(Re)),m=t[o],g=Me(l,s,e[m]),u=g[0],v=g[1];return Y({},h,(i={},i[o]=u,i[m]=v,i))},e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,i){return o.__proto__=i,o},q(e,t)}function Ge(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,q(e,t)}const Pe=["xxl","xl","lg","md","sm","xs"],$e="xs",Ue=d.createContext({prefixes:{},breakpoints:Pe,minBreakpoint:$e});function F(e,t){const{prefixes:r}=d.useContext(Ue);return e||r[t]||t}function Ve(e){return e&&e.ownerDocument||document}function He(e){var t=Ve(e);return t&&t.defaultView||window}function Je(e,t){return He(e).getComputedStyle(e,t)}var Ke=/([A-Z])/g;function Xe(e){return e.replace(Ke,"-$1").toLowerCase()}var We=/^ms-/;function H(e){return Xe(e).replace(We,"-ms-")}var ze=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function Ye(e){return!!(e&&ze.test(e))}function K(e,t){var r="",o="";if(typeof t=="string")return e.style.getPropertyValue(H(t))||Je(e).getPropertyValue(H(t));Object.keys(t).forEach(function(i){var a=t[i];!a&&a!==0?e.style.removeProperty(H(i)):Ye(i)?o+=i+"("+a+") ":r+=H(i)+": "+a+";"}),o&&(r+="transform: "+o+";"),e.style.cssText+=";"+r}const ne={disabled:!1},fe=B.createContext(null);var qe=function(t){return t.scrollTop},U="unmounted",A="exited",T="entering",I="entered",X="exiting",O=function(e){Ge(t,e);function t(o,i){var a;a=e.call(this,o,i)||this;var s=i,l=s&&!s.isMounting?o.enter:o.appear,h;return a.appearStatus=null,o.in?l?(h=A,a.appearStatus=T):h=I:o.unmountOnExit||o.mountOnEnter?h=U:h=A,a.state={status:h},a.nextCallback=null,a}t.getDerivedStateFromProps=function(i,a){var s=i.in;return s&&a.status===U?{status:A}:null};var r=t.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(i){var a=null;if(i!==this.props){var s=this.state.status;this.props.in?s!==T&&s!==I&&(a=T):(s===T||s===I)&&(a=X)}this.updateStatus(!1,a)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var i=this.props.timeout,a,s,l;return a=s=l=i,i!=null&&typeof i!="number"&&(a=i.exit,s=i.enter,l=i.appear!==void 0?i.appear:s),{exit:a,enter:s,appear:l}},r.updateStatus=function(i,a){if(i===void 0&&(i=!1),a!==null)if(this.cancelNextCallback(),a===T){if(this.props.unmountOnExit||this.props.mountOnEnter){var s=this.props.nodeRef?this.props.nodeRef.current:$.findDOMNode(this);s&&qe(s)}this.performEnter(i)}else this.performExit();else this.props.unmountOnExit&&this.state.status===A&&this.setState({status:U})},r.performEnter=function(i){var a=this,s=this.props.enter,l=this.context?this.context.isMounting:i,h=this.props.nodeRef?[l]:[$.findDOMNode(this),l],m=h[0],g=h[1],u=this.getTimeouts(),v=l?u.appear:u.enter;if(!i&&!s||ne.disabled){this.safeSetState({status:I},function(){a.props.onEntered(m)});return}this.props.onEnter(m,g),this.safeSetState({status:T},function(){a.props.onEntering(m,g),a.onTransitionEnd(v,function(){a.safeSetState({status:I},function(){a.props.onEntered(m,g)})})})},r.performExit=function(){var i=this,a=this.props.exit,s=this.getTimeouts(),l=this.props.nodeRef?void 0:$.findDOMNode(this);if(!a||ne.disabled){this.safeSetState({status:A},function(){i.props.onExited(l)});return}this.props.onExit(l),this.safeSetState({status:X},function(){i.props.onExiting(l),i.onTransitionEnd(s.exit,function(){i.safeSetState({status:A},function(){i.props.onExited(l)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(i,a){a=this.setNextCallback(a),this.setState(i,a)},r.setNextCallback=function(i){var a=this,s=!0;return this.nextCallback=function(l){s&&(s=!1,a.nextCallback=null,i(l))},this.nextCallback.cancel=function(){s=!1},this.nextCallback},r.onTransitionEnd=function(i,a){this.setNextCallback(a);var s=this.props.nodeRef?this.props.nodeRef.current:$.findDOMNode(this),l=i==null&&!this.props.addEndListener;if(!s||l){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var h=this.props.nodeRef?[this.nextCallback]:[s,this.nextCallback],m=h[0],g=h[1];this.props.addEndListener(m,g)}i!=null&&setTimeout(this.nextCallback,i)},r.render=function(){var i=this.state.status;if(i===U)return null;var a=this.props,s=a.children;a.in,a.mountOnEnter,a.unmountOnExit,a.appear,a.enter,a.exit,a.timeout,a.addEndListener,a.onEnter,a.onEntering,a.onEntered,a.onExit,a.onExiting,a.onExited,a.nodeRef;var l=ue(a,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return B.createElement(fe.Provider,{value:null},typeof s=="function"?s(i,l):B.cloneElement(B.Children.only(s),l))},t}(B.Component);O.contextType=fe;O.propTypes={};function _(){}O.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:_,onEntering:_,onEntered:_,onExit:_,onExiting:_,onExited:_};O.UNMOUNTED=U;O.EXITED=A;O.ENTERING=T;O.ENTERED=I;O.EXITING=X;const Ze=O,Qe=!!(typeof window<"u"&&window.document&&window.document.createElement);var Z=!1,Q=!1;try{var z={get passive(){return Z=!0},get once(){return Q=Z=!0}};Qe&&(window.addEventListener("test",z,z),window.removeEventListener("test",z,!0))}catch{}function et(e,t,r,o){if(o&&typeof o!="boolean"&&!Q){var i=o.once,a=o.capture,s=r;!Q&&i&&(s=r.__once||function l(h){this.removeEventListener(t,l,a),r.call(this,h)},r.__once=s),e.addEventListener(t,s,Z?o:a)}e.addEventListener(t,r,o)}function tt(e,t,r,o){var i=o&&typeof o!="boolean"?o.capture:o;e.removeEventListener(t,r,i),r.__once&&e.removeEventListener(t,r.__once,i)}function he(e,t,r,o){return et(e,t,r,o),function(){tt(e,t,r,o)}}function nt(e,t,r,o){if(r===void 0&&(r=!1),o===void 0&&(o=!0),e){var i=document.createEvent("HTMLEvents");i.initEvent(t,r,o),e.dispatchEvent(i)}}function rt(e){var t=K(e,"transitionDuration")||"",r=t.indexOf("ms")===-1?1e3:1;return parseFloat(t)*r}function ot(e,t,r){r===void 0&&(r=5);var o=!1,i=setTimeout(function(){o||nt(e,"transitionend",!0)},t+r),a=he(e,"transitionend",function(){o=!0},{once:!0});return function(){clearTimeout(i),a()}}function at(e,t,r,o){r==null&&(r=rt(e)||0);var i=ot(e,r,o),a=he(e,"transitionend",t);return function(){i(),a()}}function re(e,t){const r=K(e,t)||"",o=r.indexOf("ms")===-1?1e3:1;return parseFloat(r)*o}function it(e,t){const r=re(e,"transitionDuration"),o=re(e,"transitionDelay"),i=at(e,a=>{a.target===e&&(i(),t(a))},r+o)}function P(...e){return e.filter(t=>t!=null).reduce((t,r)=>{if(typeof r!="function")throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return t===null?r:function(...i){t.apply(this,i),r.apply(this,i)}},null)}function st(e){e.offsetHeight}const oe=e=>!e||typeof e=="function"?e:t=>{e.current=t};function lt(e,t){const r=oe(e),o=oe(t);return i=>{r&&r(i),o&&o(i)}}function ct(e,t){return d.useMemo(()=>lt(e,t),[e,t])}function dt(e){return e&&"setState"in e?$.findDOMNode(e):e??null}const ut=B.forwardRef(({onEnter:e,onEntering:t,onEntered:r,onExit:o,onExiting:i,onExited:a,addEndListener:s,children:l,childRef:h,...m},g)=>{const u=d.useRef(null),v=ct(u,h),S=p=>{v(dt(p))},y=p=>j=>{p&&u.current&&p(u.current,j)},N=d.useCallback(y(e),[e]),f=d.useCallback(y(t),[t]),E=d.useCallback(y(r),[r]),c=d.useCallback(y(o),[o]),x=d.useCallback(y(i),[i]),b=d.useCallback(y(a),[a]),L=d.useCallback(y(s),[s]);return n.jsx(Ze,{ref:g,...m,onEnter:N,onEntered:E,onEntering:f,onExit:c,onExited:b,onExiting:x,addEndListener:L,nodeRef:u,children:typeof l=="function"?(p,j)=>l(p,{...j,ref:S}):B.cloneElement(l,{ref:S})})}),ft=ut,ht={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function pt(e,t){const r=`offset${e[0].toUpperCase()}${e.slice(1)}`,o=t[r],i=ht[e];return o+parseInt(K(t,i[0]),10)+parseInt(K(t,i[1]),10)}const mt={[A]:"collapse",[X]:"collapsing",[T]:"collapsing",[I]:"collapse show"},xt=B.forwardRef(({onEnter:e,onEntering:t,onEntered:r,onExit:o,onExiting:i,className:a,children:s,dimension:l="height",in:h=!1,timeout:m=300,mountOnEnter:g=!1,unmountOnExit:u=!1,appear:v=!1,getDimensionValue:S=pt,...y},N)=>{const f=typeof l=="function"?l():l,E=d.useMemo(()=>P(p=>{p.style[f]="0"},e),[f,e]),c=d.useMemo(()=>P(p=>{const j=`scroll${f[0].toUpperCase()}${f.slice(1)}`;p.style[f]=`${p[j]}px`},t),[f,t]),x=d.useMemo(()=>P(p=>{p.style[f]=null},r),[f,r]),b=d.useMemo(()=>P(p=>{p.style[f]=`${S(f,p)}px`,st(p)},o),[o,S,f]),L=d.useMemo(()=>P(p=>{p.style[f]=null},i),[f,i]);return n.jsx(ft,{ref:N,addEndListener:it,...y,"aria-expanded":y.role?h:null,onEnter:E,onEntering:c,onEntered:x,onExit:b,onExiting:L,childRef:s.ref,in:h,timeout:m,mountOnEnter:g,unmountOnExit:u,appear:v,children:(p,j)=>B.cloneElement(s,{...j,className:R(a,s.props.className,mt[p],f==="width"&&"collapse-horizontal")})})}),vt=xt;function pe(e,t){return Array.isArray(e)?e.includes(t):e===t}const me=d.createContext({});me.displayName="AccordionContext";const W=me,xe=d.forwardRef(({as:e="div",bsPrefix:t,className:r,children:o,eventKey:i,...a},s)=>{const{activeEventKey:l}=d.useContext(W);return t=F(t,"accordion-collapse"),n.jsx(vt,{ref:s,in:pe(l,i),...a,className:R(r,t),children:n.jsx(e,{children:d.Children.only(o)})})});xe.displayName="AccordionCollapse";const ve=xe,ge=d.createContext({eventKey:""});ge.displayName="AccordionItemContext";const ee=ge,ye=d.forwardRef(({as:e="div",bsPrefix:t,className:r,onEnter:o,onEntering:i,onEntered:a,onExit:s,onExiting:l,onExited:h,...m},g)=>{t=F(t,"accordion-body");const{eventKey:u}=d.useContext(ee);return n.jsx(ve,{eventKey:u,onEnter:o,onEntering:i,onEntered:a,onExit:s,onExiting:l,onExited:h,children:n.jsx(e,{ref:g,...m,className:R(r,t)})})});ye.displayName="AccordionBody";const gt=ye;function yt(e,t){const{activeEventKey:r,onSelect:o,alwaysOpen:i}=d.useContext(W);return a=>{let s=e===r?null:e;i&&(Array.isArray(r)?r.includes(e)?s=r.filter(l=>l!==e):s=[...r,e]:s=[e]),o==null||o(s,a),t==null||t(a)}}const Ee=d.forwardRef(({as:e="button",bsPrefix:t,className:r,onClick:o,...i},a)=>{t=F(t,"accordion-button");const{eventKey:s}=d.useContext(ee),l=yt(s,o),{activeEventKey:h}=d.useContext(W);return e==="button"&&(i.type="button"),n.jsx(e,{ref:a,onClick:l,...i,"aria-expanded":Array.isArray(h)?h.includes(s):s===h,className:R(r,t,!pe(h,s)&&"collapsed")})});Ee.displayName="AccordionButton";const je=Ee,we=d.forwardRef(({as:e="h2",bsPrefix:t,className:r,children:o,onClick:i,...a},s)=>(t=F(t,"accordion-header"),n.jsx(e,{ref:s,...a,className:R(r,t),children:n.jsx(je,{onClick:i,children:o})})));we.displayName="AccordionHeader";const Et=we,be=d.forwardRef(({as:e="div",bsPrefix:t,className:r,eventKey:o,...i},a)=>{t=F(t,"accordion-item");const s=d.useMemo(()=>({eventKey:o}),[o]);return n.jsx(ee.Provider,{value:s,children:n.jsx(e,{ref:a,...i,className:R(r,t)})})});be.displayName="AccordionItem";const jt=be,Se=d.forwardRef((e,t)=>{const{as:r="div",activeKey:o,bsPrefix:i,className:a,onSelect:s,flush:l,alwaysOpen:h,...m}=Fe(e,{activeKey:"onSelect"}),g=F(i,"accordion"),u=d.useMemo(()=>({activeEventKey:o,onSelect:s,alwaysOpen:h}),[o,s,h]);return n.jsx(W.Provider,{value:u,children:n.jsx(r,{ref:t,...m,className:R(a,g,l&&`${g}-flush`)})})});Se.displayName="Accordion";const J=Object.assign(Se,{Button:je,Collapse:ve,Item:jt,Header:Et,Body:gt});function wt({folders:e,blocks:t,select:r,newBlock:o,setFolders:i,gameId:a}){async function s(l){if(!navigator.onLine){alert("Cannot delete folders while offline");return}if(!window.confirm("Are you sure want to delete this folder & its blocks?"))return;const h=t.filter(m=>m.folderid===l.id);try{h.map(async m=>{await k(C(w,"Blocks",m.id))}),await k(C(w,"Folders",l.id)),i(e.filter(m=>m.id!==l.id))}catch(m){console.error(m),alert("Failed to delete this folder, try again later.")}}return n.jsx(J,{className:"accordion-container",children:e.map(l=>n.jsxs(J.Item,{eventKey:l.id,style:{border:"1px solid grey"},children:[n.jsx(J.Header,{children:l.title}),n.jsxs(J.Body,{style:{paddingTop:"20px",paddingLeft:"8px",paddingRight:"8px"},children:[n.jsx(Te,{blocks:t.filter(h=>h.folderid===l.id),select:r}),n.jsxs("span",{className:"folder-btn",children:[n.jsx("button",{onClick:()=>o(l.id),children:"New Block"}),n.jsx("button",{style:{backgroundColor:"red"},onClick:()=>s(l),children:"Delete Folder"})]})]})]},l.id))})}const bt=`
<h1>Main Heading</h1>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
<hr/>
<h1>Main Heading</h1>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
<h2>Sub Heading</h2>
<p>Contents</p>
`,St=`
<h2>Numbered List</h2>
<ol>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
</ol>
<p></p>
`,Ct=`
<h2>Dotted List</h2>
<ul>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
    <li>List Item</li>
</ul>
<p></p>
`,Nt=`
<table>
    <tr>
        <th>heading</th>
        <th>heading</th>
        <th>heading</th>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td></td>
        <td></td>
    </tr>
</table>
<p></p>
`;function kt({content:e,close:t}){return n.jsxs("li",{children:[n.jsx("label",{children:"Use Template: "}),n.jsxs("select",{className:"option-select",defaultValue:"defualt",onChange:r=>{e[1](e[0]+r.target.value),t()},children:[n.jsx("option",{value:"defualt",disabled:!0,children:"None"}),n.jsx("option",{value:bt,children:"Headings"}),n.jsx("option",{value:St,children:"Numbered List"}),n.jsx("option",{value:Ct,children:"Dotted List"}),n.jsx("option",{value:Nt,children:"Table"})]})]})}function Dt({colour:e,gameId:t,data:r,blocks:o,links:i,closeBlock:a,blockLinks:s,block:l,placements:h,boards:m,content:g}){const[u,v]=d.useState(!1),S=async c=>{if(c.preventDefault(),v(!1),!navigator.onLine){alert("Cannot save blocks while offline");return}try{let x=l;x.title=r[0],x.content=r[1],l.new?(delete x.new,await V(M(w,"Blocks"),x).then(b=>{x.id=b.id,o[1]([...o[0],x])})):(await ae(C(w,"Blocks",l.id),{title:r[0],content:r[1]}),o[1](o[0].map(b=>b.id===x.id?x:b))),alert("Block saved successfuly!")}catch(x){console.error(x),alert("Failed to save this block, try again later.")}},y=async()=>{if(!navigator.onLine){alert("Cannot delete blocks while offline");return}if(window.confirm("Are you sure you want to delete this block?"))try{await k(C(w,"Blocks",l.id)),o[1](o[0].filter(x=>x.id!=l.id));let c=[...i[0]];s.map(async x=>{await k(C(w,"Links",x.linkId)).then(c=c.filter(b=>b.id!==x.linkId))}),i[1](c),h.map(async x=>{x.blockid===l.id&&await k(C(w,"Placements",x.id))}),h[1]([...h[0].filter(x=>x.blockid!==l.id)]),a()}catch(c){console.error(c),alert("Something went wrong, try again later.")}},N=async c=>{if(!navigator.onLine){alert("Cannot link blocks while offline");return}if(c===l.id){alert("Cannot link a block to itself");return}let x=!1;if(s.map(b=>{b.id===c&&(x=!0)}),x){alert("Selected block is already linked to this one");return}try{let b={block1:l.id,block2:c,gameid:t};await V(M(w,"Links"),b).then(L=>{b.id=L.id,i[1]([...i[0],b])})}catch(b){console.error(b),alert("Something went wrong, try again later.")}},f=async c=>{if(!navigator.onLine){alert("Cannot add to boards while offline");return}try{let x={blockid:l.id,boardid:c,gameid:t};await V(M(w,"Placements"),x).then(b=>{x.id=b.id}),h[1]([...h[0],x]),alert("Block added to selected board.")}catch(x){console.error(x),alert("Something went wrong, try again later.")}},E=()=>v(!1);return n.jsxs("div",{style:{display:"inline"},children:[n.jsx("button",{className:"options-btn",onClick:()=>v(!u),style:{backgroundColor:`${e}`},children:"Options"}),n.jsx(ie,{message:ke}),u&&n.jsxs("ul",{className:"options-collapse",children:[n.jsx("li",{onClick:E,children:"Close Options"}),n.jsx("li",{onClick:c=>S(c),children:"Save"}),n.jsx(kt,{content:g,close:E}),!l.new&&n.jsxs(n.Fragment,{children:[n.jsxs("li",{children:[n.jsx("label",{children:"Link to: "}),n.jsxs("select",{className:"option-select",defaultValue:"defualt",onChange:c=>{N(c.target.value),E()},children:[n.jsx("option",{value:"defualt",disabled:!0,children:"Select Block"}),o[0].map(c=>n.jsx("option",{value:c.id,children:c.title},c.id))]})]}),n.jsxs("li",{children:[n.jsx("label",{children:"Add to Board: "}),n.jsxs("select",{className:"option-select",defaultValue:"defualt",onChange:c=>{f(c.target.value),E()},children:[n.jsx("option",{value:"defualt",disabled:!0,children:"Select Board"}),m.map(c=>n.jsx("option",{value:c.id,children:c.title},c.id))]})]}),n.jsx("li",{children:n.jsx(se,{to:"../share/"+l.id,target:"_blank",children:"Share"})}),n.jsx("li",{onClick:y,style:{color:"red"},children:"Delete"})]})]})]})}function Lt({content:e,setContent:t}){return n.jsx(le,{apiKey:"c70a4j85ev1e4q1dopyxbpw772r0lz047pef9umlig63xfdh",value:e,onEditorChange:(r,o)=>t(o.getContent()),init:{height:360,menubar:!1,browser_spellcheck:!0,resize:!1,plugins:"table | lists",toolbar:"undo redo | blocks | bold italic forecolor | bullist numlist outdent indent | table tabledelete | tableprops tablerowprops tablecellprops | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol"}})}function Bt({block:e,setBlocks:t,close:r,blocks:o,colour:i,gameId:a,links:s,setLinks:l,select:h,setPlacements:m,boards:g,placements:u}){const[v,S]=d.useState(""),[y,N]=d.useState(""),[f,E]=d.useState([]);d.useEffect(()=>{S(e.title),N(e.content),E(c())},[e]),d.useEffect(()=>{E(c())},[s]),d.useEffect(()=>{let p=JSON.parse(localStorage.getItem("SELECTED_BLOCKS"));if(!(p===null||p.length<1)){for(let j=0;j<p.length;j++)if(p[j].id===e.id){p[j].title=v,p[j].content=y,localStorage.setItem("SELECTED_BLOCKS",JSON.stringify(p));return}}},[v,y]);const c=()=>{let p=[];return s.map(j=>{if(j.block1===e.id){let D=o.filter(G=>G.id===j.block2)[0];D.linkId=j.id,p.push(D)}else if(j.block2===e.id){let D=o.filter(G=>G.id===j.block1)[0];D.linkId=j.id,p.push(D)}}),p},x=()=>{y!==e.content&&!window.confirm("Unsaved changes detected, are you sure you want to continue?")||r()},b=async(p,j)=>{if(!navigator.onLine){alert("Cannot delete links while offline");return}if(window.confirm(`Are you sure you want to delete the link to "${j}"?`))try{await k(C(w,"Links",p));let D=[...s].filter(G=>G.id!==p);l(D),L(D)}catch(D){console.error(D),alert("Something went wrong, try again later.")}},L=p=>{let j=JSON.parse(localStorage.getItem("SAVED_GAMES"));j!==null&&(j.map(D=>(D.game.id===a&&(D.links=p),D)),localStorage.setItem("SAVED_GAMES",JSON.stringify(j)))};return n.jsxs("div",{className:"block",children:[n.jsx(Dt,{colour:i,gameId:a,data:[v,y],content:[y,N],blocks:[o,t],boards:g,links:[s,l],closeBlock:r,blockLinks:f,block:e,placements:[u,m]}),n.jsx("button",{className:"x-btn",onClick:x,children:"X"}),n.jsx("input",{value:v,className:"block-title",onChange:p=>S(p.target.value)}),n.jsx("br",{}),navigator.onLine?n.jsx(Lt,{content:y,setContent:N}):n.jsx("textarea",{value:ce(y,{wordwrap:80}),className:"block-content"}),n.jsx("p",{className:"related-blocks",children:f.map(p=>n.jsxs("span",{children:[n.jsx("span",{onClick:()=>h(p),children:p.title}),n.jsx("label",{onClick:()=>b(p.linkId,p.title),children:"X"})]},p.id))})]})}function Ot({setFolders:e,folders:t,gameId:r}){const[o,i]=d.useState("");async function a(s){if(s.preventDefault(),!navigator.onLine){alert("Cannot create folders while offline");return}if(o===""){alert("Enter a title for your new folder first.");return}if(o.length>25){alert("Folder titles cannot be longer than 25 digits long.");return}try{await V(M(w,"Folders"),{title:o,gameid:r}).then(l=>{e([...t,{id:l.id,title:o,gameid:r}])}),i("")}catch(l){console.error(l),alert("Something went wrong and we coudlnt create your folder, please try again later")}}return n.jsxs("form",{onSubmit:s=>a(s),children:[n.jsx("input",{placeholder:"Folder title...",className:"form-input",style:{width:"85%",marginBottom:"-5px"},value:o,onChange:s=>i(s.target.value),style:{width:"70%",marginBottom:"0px"}}),n.jsx(ie,{message:De}),n.jsx("button",{className:"form-btn",style:{width:"85%",padding:"5px"},type:"submit",children:"New Folder"})]})}function At({select:e,blocks:t}){const[r,o]=d.useState([]);function i(a){if(a===""){o([]);return}o(t.filter(s=>s.title.toLowerCase().includes(a.toLowerCase())))}return n.jsxs(n.Fragment,{children:[n.jsx("input",{placeholder:"Search...",className:"search-bar",onChange:a=>i(a.target.value),onClick:a=>i(a.target.value)}),n.jsx("ul",{className:"search-results",children:r.map(a=>n.jsx("li",{onClick:()=>{e(a),i("")},children:a.title}))})]})}function Tt({blocks:e,gameId:t,setBlocks:r,folders:o,setFolders:i,colour:a,links:s,setLinks:l,setPlacements:h,boards:m,placements:g}){const[u,v]=d.useState(()=>{const f=localStorage.getItem("SELECTED_BLOCKS");return JSON.parse(f)===null?[]:JSON.parse(f)});d.useEffect(()=>{localStorage.setItem("SELECTED_BLOCKS",JSON.stringify(u))},[u]);const S=f=>{y({title:"New Block",content:"",gameid:t,folderid:f,new:!0})},y=f=>{u.includes(f)||v([...u,f])},N=f=>v([...u].filter(E=>E.id!==f));return n.jsxs("div",{style:{display:"flex"},className:"blocks-container",children:[n.jsxs("div",{className:"folderList",children:[n.jsx(At,{select:y,blocks:e}),o.length>0&&n.jsx(wt,{folders:o,blocks:e,select:y,newBlock:S,setFolders:i,gameId:t}),n.jsx(Ot,{setFolders:i,folders:o,gameId:t})]}),n.jsx("div",{className:"block-list",children:u.map(f=>n.jsx(Bt,{block:f,blocks:e,colour:a,gameId:t,setLinks:l,setBlocks:r,close:()=>N(f.id),links:s,select:y,setPlacements:h,boards:m,placements:g},f.id))})]})}const It="/assets/YlWC-82c90721.gif";function Rt(){const[e,t]=d.useState(null),[r,o]=d.useState(20),i=()=>{t(Math.floor(Math.random()*r)+1);var a=document.getElementById("result");a.style.fontSize="1.4em",setTimeout(()=>a.style.fontSize="1.3em",200)};return n.jsxs("span",{style:{marginTop:"10px",marginLeft:"auto"},children:[n.jsxs("select",{style:{padding:"3px"},onChange:a=>{o(a.target.value),i()},children:[n.jsx("option",{value:20,default:!0,children:"d20"}),n.jsx("option",{value:12,children:"d12"}),n.jsx("option",{value:10,children:"d10"}),n.jsx("option",{value:8,children:"d8"}),n.jsx("option",{value:6,children:"d6"}),n.jsx("option",{value:4,children:"d4"}),n.jsx("option",{value:100,children:"d100"})]}),n.jsx("button",{onClick:i,style:{border:"none",padding:"2px"},children:"Roll!"}),n.jsx("div",{className:"roll-result",children:e&&n.jsx("div",{id:"result",children:e})})]})}function _t({selected:e,setSelected:t,game:r}){return n.jsxs("div",{className:"nav-bar",style:{backgroundColor:`${r.colour}`},children:[n.jsx("h1",{className:"nav-title",children:r.title}),r.title==="Loading"&&n.jsx("img",{src:It,className:"loading-icon"}),e==="blocks"?n.jsx("button",{className:"nav-item",style:{textDecoration:"underline"},children:"Blocks"}):n.jsx("button",{className:"nav-item",onClick:()=>t("blocks"),children:"Blocks"}),e==="boards"?n.jsx("button",{className:"nav-item",style:{textDecoration:"underline"},children:"Boards"}):n.jsx("button",{className:"nav-item",onClick:()=>t("boards"),children:"Boards"}),e==="details"?n.jsx("button",{className:"nav-item",style:{textDecoration:"underline"},children:"Details"}):n.jsx("button",{className:"nav-item",onClick:()=>t("details"),children:"Details"}),n.jsx(Rt,{})]})}function Mt({blocks:e,setPlacements:t,placements:r}){const[o,i]=d.useState([]);d.useEffect(()=>{i(e.sort((s,l)=>l.content.length-s.content.length))},[e]);const a=async s=>{if(window.confirm(`Are you sure you want to delete "${s.title}" from this board?`))try{await k(C(w,"Placements",s.placement)),t([...r].filter(l=>l.id!==s.placement))}catch(l){console.log(l),alert("something went wrong, try again later")}};return n.jsx("div",{className:"board-blocks",children:o.map(s=>n.jsxs("div",{children:[n.jsx("button",{className:"x-btn",onClick:()=>a(s),children:"X"}),n.jsx("h2",{children:s.title}),n.jsx("span",{children:navigator.onLine?n.jsx(le,{apiKey:"c70a4j85ev1e4q1dopyxbpw772r0lz047pef9umlig63xfdh",value:s.content,disabled:!0,inline:!0,init:{menubar:!1,toolbar:!1,resize:!1}}):n.jsx("textarea",{value:ce(s.content,{wordwrap:80})})})]},s.id))})}function Ft({boards:e,select:t,gameId:r,setBoards:o,placements:i,setPlacements:a,selected:s}){const[l,h]=d.useState(""),m=async()=>{if(!navigator.onLine){alert("Cannot create board while offline");return}try{let u={title:l,gameid:r};await V(M(w,"Boards"),u).then(v=>u.id=v.id),o([...e,u]),t(u.id),h(""),alert("New Board Created!")}catch(u){console.log(u),alert("Something went wrong, try again later.")}},g=async()=>{if(!s){alert("Select a board to delete.");return}if(!navigator.onLine){alert("Cannot delete boards while offline");return}if(window.confirm("Are you sure you want to delete this board?"))try{i.map(async u=>{u.boardid===s&&await k(C(w,"Placements",u.id))}),a([...i].filter(u=>u.boardid!==s)),await k(C(w,"Boards",s)),t(null)}catch(u){console.log(u),alert("Something went wrong, try again later.")}};return n.jsxs("div",{className:"board-control",children:[n.jsxs("div",{children:[n.jsxs("select",{defaultValue:"default",className:"form-input",style:{padding:"6px"},onChange:u=>t(u.target.value),children:[n.jsx("option",{value:"default",disabled:!0,children:"Select a Board"}),e.map(u=>n.jsx("option",{value:u.id,children:u.title},u.id))]}),n.jsx("br",{}),n.jsx("button",{className:"form-btn",style:{backgroundColor:"red"},onClick:()=>g(),children:"Delete Board"})]}),n.jsxs("div",{children:[n.jsx("input",{placeholder:"Board Title...",className:"form-input",value:l,onChange:u=>h(u.target.value)}),n.jsx("br",{}),n.jsx("button",{className:"form-btn",onClick:()=>m(),children:"Create Board"})]})]})}function Gt({boards:e,placements:t,blocks:r,gameId:o,setBoards:i,setPlacements:a}){const[s,l]=d.useState(()=>{const u=localStorage.getItem("SELECTED_BOARD");return JSON.parse(u)}),[h,m]=d.useState([]);d.useEffect(()=>{localStorage.setItem("SELECTED_BOARD",JSON.stringify(s))},[s]),d.useEffect(()=>{let u=[];t.filter(v=>v.boardid===s).map(v=>{let S=r.find(y=>y.id===v.blockid);S.placement=v.id,u.push(S)}),m(u)},[s,t]);const g=u=>u==null?"":e.filter(v=>v.id==u)[0].title;return n.jsxs("div",{className:"boards-container",children:[n.jsx("h1",{style:{fontWeight:"bold"},children:g(s)}),n.jsx(Mt,{blocks:h,setPlacements:a,placements:t,gameId:o}),n.jsx(Ft,{boards:e,select:l,gameId:o,setBoards:i,placements:t,setPlacements:a,selected:s}),n.jsx("p",{className:"board-control",children:"Boards allow you to create custom collections of information from your blocks. Use this tool to gather all the info you would need for a session. Select a board to view the blocks within. You can click on a block to expand or minimise it. Click the X button to remove it from that board."})]})}function $t({user:e}){const t=Le(),[r,o]=d.useState("blocks"),[i,a]=d.useState({title:"Loading",colour:"red"}),[s,l]=d.useState([]),[h,m]=d.useState([]),[g,u]=d.useState([]),[v,S]=d.useState([]),[y,N]=d.useState([]);d.useEffect(()=>{f(),E("Blocks").then(c=>l(c)),E("Folders").then(c=>N(c)),E("Links").then(c=>m(c)),E("Boards").then(c=>u(c)),E("Placements").then(c=>S(c))},[]);const f=d.useCallback(async()=>{try{const c=await Be(C(w,"Games",t==null?void 0:t.state.gameid)),x={...c.data(),id:c.id};a(x)}catch(c){console.error(c)}}),E=d.useCallback(async c=>{try{return(await Oe(M(w,c))).docs.map(L=>({...L.data(),id:L.id})).filter(L=>L.gameid===(t==null?void 0:t.state.gameid))}catch(x){console.error(x)}});return n.jsx(n.Fragment,{children:e?n.jsxs(n.Fragment,{children:[n.jsx(_t,{selected:r,setSelected:o,game:i}),n.jsx("div",{children:i.title!=="Loading..."&&n.jsxs(n.Fragment,{children:[r==="details"&&n.jsx(Ae,{game:i,setGame:a,details:[s,y,h,g,v]}),r==="blocks"&&n.jsx(Tt,{blocks:s,setBlocks:l,colour:i.colour,setLinks:m,boards:g,gameId:i.id,folders:y,setFolders:N,links:h,setPlacements:S,placements:v}),r==="boards"&&n.jsx(Gt,{boards:g,setBoards:u,placements:v,blocks:s,gameId:i.id,setPlacements:S})]})})]}):n.jsxs("h1",{className:"menu",children:["You must first ",n.jsx(se,{to:"/login",children:"login"})," to access this page"]})})}export{$t as default};
